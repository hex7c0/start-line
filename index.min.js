"use strict";function interfac(a,b,c){var d;return d=c>=0?fs.createReadStream(a.file,{flags:a.flag,mode:a.mode,encoding:a.encoding,autoClose:a.autoClose,start:b,end:c,fd:null}):fs.createReadStream(a.file,{flags:a.flag,mode:a.mode,encoding:a.encoding,autoClose:a.autoClose,start:b,fd:null})}function readlin(a,b,c){var d;return d=readline.createInterface({input:interfac(a,b,c),output:null,terminal:!1})}function startline(a){var b,c=a||Object.create(null);if(!Boolean(c.file))throw new Error('"file" is required');if(b=require("path").resolve(String(c.file)),!fs.existsSync(b)){var d=b+" not exists";throw new Error(d)}var e={file:b,encoding:c.encoding,flag:String(c.flag||"r"),mode:Number(c.mode)||444,autoClose:c.autoClose===!1?!1:!0,start:Number(c.start)||0,end:Number(c.end),rc4:c.rc4,autokey:c.autokey,lodash:Boolean(c.autokey)};return new STARTLINE(e)}function STARTLINE(a){event.call(this);var b=this,c="";if(this.options=a,this.head=0,this.tail=0,this.line=0,this._stream=null,a.rc4||a.autokey){var d;this._stream=interfac(this.options,a.start,a.end),a.rc4?(d=require("arc4")(String(a.rc4),a.lodash),this._stream.on("data",function(a){for(var e=d.decodeBuffer(a).toString(),f=0,g=e.length;g>f;f++)e[f]===eol?(b.tail=b.head+b.line,b.head=b.tail+c.length,b.emit("line",c),b.line=1,c=""):c+=e[f];c.length>0&&(b.tail=b.head+b.line,b.head=b.tail+c.length,b.emit("line",c),b.line=1)})):(d=require("autokey")(String(a.autokey),a.lodash),this._stream.on("data",function(a){for(var e=d.decodeBuffer(a).toString(),f=0,g=e.length;g>f;f++)e[f]===eol?(b.tail=b.head+b.line,b.head=b.tail+c.length,b.emit("line",c),b.line=1,c=""):c+=e[f];c.length>0&&(b.tail=b.head+b.line,b.head=b.tail+c.length,b.emit("line",c),b.line=1)}))}else a.end>=0?(this._stream=interfac(this.options,a.start,a.end),this._stream.on("data",function(a){for(var d=a.toString(),e=0,f=d.length;f>e;e++)d[e]===eol?(b.tail=b.head+b.line,b.head=b.tail+c.length,b.emit("line",c),b.line=1,c=""):c+=d[e];c.length>0&&(b.tail=b.head+b.line,b.head=b.tail+c.length,b.emit("line",c),b.line=1)})):(this._stream=readlin(this.options,a.start,a.end),this._stream.on("line",function(a){b.tail=b.head+b.line,b.head=b.tail+a.length,b.emit("line",a),b.line=1}));this._stream.on("pause",function(){b.emit("pause")}),this._stream.on("resume",function(){b.emit("resume")}),this._stream.on("open",function(a){b.emit("open",a)}),this._stream.on("close",function(){b.emit("close")}),this._stream.on("end",function(){b.emit("end")}),this._stream.on("error",function(a){b.emit("error",a)})}var fs=require("fs"),readline=require("readline"),event=require("events").EventEmitter,inherits=require("util").inherits,eol=require("os").EOL;module.exports=startline,inherits(STARTLINE,event),STARTLINE.prototype.pause=function(){this._stream.pause()},STARTLINE.prototype.resume=function(){this._stream.resume()},STARTLINE.prototype.read=function(a,b){var c=this.options;return c.start=Number(a)||0,c.end=Number(b),new STARTLINE(c)};
